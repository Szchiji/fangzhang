{% extends "layout.html" %}
{% block content %}
<div class="card p-4 border-0 shadow-sm">
    <h5 class="fw-bold mb-4">æŸ¥è¯¢æŒ‡ä»¤ä¸æ¨¡æ¿é…ç½®</h5>
    <div class="mb-4">
        <label class="small fw-bold mb-2">æŸ¥è¯¢è§¦å‘æŒ‡ä»¤</label>
        <input type="text" class="form-control" value="{{g[9]}}" onchange="updateVal('query_cmd', this.value)">
    </div>
    
    <div class="mb-4">
        <label class="small fw-bold mb-3">åœ¨çº¿äººå‘˜åˆ—è¡¨æ¨¡æ¿</label>
        <div class="d-flex flex-wrap gap-2 mb-3">
            <button class="btn btn-sm btn-outline-primary rounded-pill px-3" onclick="addTag('{åå­—}')">ğŸ‘¤ ç”¨æˆ·åå­—</button>
            <button class="btn btn-sm btn-outline-danger rounded-pill px-3" onclick="addTag('{åœ°åŒº}')">ğŸ“ åœ°åŒº</button>
            <button class="btn btn-sm btn-outline-success rounded-pill px-3" onclick="addTag('{è€å¸ˆ}')">ğŸ´ è€å¸ˆå</button>
            <button class="btn btn-sm btn-outline-info rounded-pill px-3" onclick="addTag('{æ—¶é—´}')">â° æ—¶é—´</button>
        </div>
        <textarea id="tpl" class="form-control" rows="5" oninput="preview(this.value)" onchange="updateVal('query_tpl', this.value)">{{g[10] or '{åå­—} - {åœ°åŒº}'}}</textarea>
    </div>

    <div class="p-3 bg-light rounded border border-dashed">
        <div class="small text-muted mb-2">ğŸ‘ï¸ å®æ—¶æ•ˆæœé¢„è§ˆæ ·æ¿ï¼š</div>
        <div id="pre" class="small"></div>
    </div>
</div>

<script>
function addTag(t) {
    const i = document.getElementById('tpl');
    i.value += t;
    preview(i.value);
    updateVal('query_tpl', i.value);
}
function preview(v) {
    const sample = v.replace(/{åå­—}/g, 'å¼ ä¸‰').replace(/{åœ°åŒº}/g, 'å°åŒ—').replace(/{è€å¸ˆ}/g, 'ç‹è€å¸ˆ').replace(/{æ—¶é—´}/g, '14:00');
    document.getElementById('pre').innerHTML = `âœ… ${sample}<br>âœ… æå›› - æ›¼è°·`;
}
async function updateVal(f, v) {
    const fd = new FormData();
    fd.append('sid', '{{sid}}'); fd.append('gid', '{{gid}}'); fd.append('field', f); fd.append('value', v);
    await fetch('/api/save', {method:'POST', body:fd});
}
preview(document.getElementById('tpl').value);
</script>
{% endblock %}
