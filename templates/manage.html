<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æœºå™¨äººå…¨èƒ½åå°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .editor-box { min-height: 120px; border: 2px solid #dee2e6; padding: 15px; border-radius: 10px; background: #fff; outline: none; transition: 0.2s; }
        .editor-box:focus { border-color: #0d6efd; box-shadow: 0 0 0 0.25rem rgba(13,110,253,0.1); }
        .card { border: none; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .tag-btn { font-size: 0.75rem; border-radius: 20px; margin-right: 5px; margin-bottom: 5px; padding: 4px 12px; }
    </style>
</head>
<body class="py-4">
    <div class="container" style="max-width: 900px;">
        <div class="d-flex align-items-center mb-4">
            <h3 class="fw-bold m-0 text-dark">ğŸ¤– æœºå™¨äºº Pro é…ç½®ä¸­å¿ƒ</h3>
        </div>

        <form action="/api/save" method="post" onsubmit="sync()">
            <input type="hidden" name="sid" value="{{sid}}">
            <input type="hidden" name="gid" value="{{gid}}">
            
            <div class="card p-4 mb-4">
                <div class="row g-3 mb-4">
                    <div class="col-md-9">
                        <label class="form-label small fw-bold text-muted">è‡ªå®šä¹‰å±æ€§ (ç”¨è‹±æ–‡é€—å·éš”å¼€)</label>
                        <input type="text" name="fields" class="form-control" value="{{group.custom_fields}}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold text-muted text-center d-block">ç‚¹èµè¡¨æƒ…</label>
                        <input type="text" name="emoji" class="form-control text-center" value="{{group.like_emoji}}">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-bold text-success">ä»Šæ—¥åå•æ ·å¼ (ç‚¹å‡»æ’å…¥å˜é‡)</label>
                    <div class="mb-2">
                        <button type="button" class="btn btn-dark tag-btn" onclick="ins('ed-list','{å§“åValue}')">å§“å</button>
                        {% if group and group.custom_fields %}
                            {% for f in group.custom_fields.split(',') %}
                            <button type="button" class="btn btn-outline-primary tag-btn" onclick="ins('ed-list','{{'{'}}{{f}}Value{{'}'}}')">{{f}}</button>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div id="ed-list" class="editor-box" contenteditable="true">{{group.list_template|safe}}</div>
                    <textarea name="list_t" id="h-list" style="display:none"></textarea>
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-bold text-primary">æ‰“å¡å›å¤æ¶ˆæ¯</label>
                    <div id="ed-check" class="editor-box" contenteditable="true">{{group.checkin_template|safe}}</div>
                    <textarea name="check_t" id="h-check" style="display:none"></textarea>
                </div>

                <button class="btn btn-dark w-100 py-2 fw-bold shadow-sm">ğŸ’¾ ä¿å­˜å¹¶åŒæ­¥é…ç½®</button>
            </div>
        </form>

        <div class="card p-4">
            <h6 class="fw-bold mb-3">ğŸ‘¨â€ğŸ« åå•æ•°æ®åº“</h6>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light small">
                        <tr><th>UID</th><th>å§“å</th><th>è¯¦ç»†æ•°æ® (JSON)</th><th>æ“ä½œ</th></tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <form action="/api/user" method="post">
                                <input type="hidden" name="sid" value="{{sid}}"><input type="hidden" name="gid" value="{{gid}}">
                                <input type="hidden" name="action" value="save">
                                <td><input type="text" name="user_id" class="form-control form-control-sm bg-light" value="{{u.user_id}}" readonly></td>
                                <td><input type="text" name="name" class="form-control form-control-sm" value="{{u.name}}"></td>
                                <td><input type="text" name="data" class="form-control form-control-sm" value="{{u.data_json}}"></td>
                                <td>
                                    <button class="btn btn-sm text-primary p-0 me-2">æ›´æ–°</button>
                                    <button name="action" value="del" class="btn btn-sm text-danger p-0" onclick="return confirm('ç¡®å®šåˆ é™¤?')">åˆ é™¤</button>
                                </td>
                            </form>
                        </tr>
                        {% endfor %}
                        <tr class="table-info">
                            <form action="/api/user" method="post">
                                <input type="hidden" name="sid" value="{{sid}}"><input type="hidden" name="gid" value="{{gid}}">
                                <input type="hidden" name="action" value="save">
                                <td><input type="text" name="user_id" class="form-control form-control-sm" placeholder="UID"></td>
                                <td><input type="text" name="name" class="form-control form-control-sm" placeholder="å§“å"></td>
                                <td><input type="text" name="data" class="form-control form-control-sm" value='{"åœ°åŒº":"åŒ—äº¬","ä»·æ ¼":"500","è”ç³»é“¾æ¥":"https://t.me/xxx"}'></td>
                                <td><button class="btn btn-sm btn-success w-100">æ·»åŠ </button></td>
                            </form>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function ins(id, t) {
            const el = document.getElementById(id);
            el.focus();
            document.execCommand('insertHTML', false, t + ' ');
        }
        function sync() {
            document.getElementById('h-list').value = document.getElementById('ed-list').innerHTML;
            document.getElementById('h-check').value = document.getElementById('ed-check').innerHTML;
        }
    </script>
</body>
</html>
