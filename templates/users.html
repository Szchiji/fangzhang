{% extends "layout.html" %}
{% block content %}
<div class="card p-4">
    <div class="d-flex justify-content-between mb-4">
        <h5 class="fw-bold">ğŸ‘¥ è®¤è¯ç”¨æˆ·ç®¡ç†</h5>
        <button class="btn btn-dark rounded-pill" onclick="openU()">+ æ–°å¢æˆæƒ</button>
    </div>
    <table class="table align-middle">
        <thead><tr class="small"><th>å§“å/UID</th><th>åœ°åŒº/è€å¸ˆ</th><th>æœ‰æ•ˆæœŸ</th><th>ç®¡ç†</th></tr></thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td><b>{{u[2]}}</b><br><small>{{u[0]}}</small></td>
                <td>{{u[4] or '-'}} / {{u[5] or '-'}}</td>
                <td><span class="badge bg-light text-dark">{{u[7] or 'æ°¸ä¹…'}}</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editU('{{u[0]}}','{{u[2]}}','{{u[4]}}','{{u[5]}}','{{u[7]}}')">ä¿®æ”¹</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="uModal" tabindex="-1">
    <div class="modal-dialog">
        <form id="uForm" class="modal-content p-4">
            <h6 class="fw-bold mb-3" id="utitle">æ–°å¢æˆæƒ</h6>
            <div class="mb-2"><label class="small fw-bold">ç”¨æˆ· ID</label><input type="text" name="user_id" id="u_id" class="form-control"></div>
            <div class="mb-2"><label class="small fw-bold">å§“å</label><input type="text" name="name" id="u_name" class="form-control"></div>
            <div class="row mb-2">
                <div class="col-6"><label class="small fw-bold">åœ°åŒº</label><input type="text" name="area" id="u_area" class="form-control"></div>
                <div class="col-6"><label class="small fw-bold">è€å¸ˆ</label><input type="text" name="teacher" id="u_teacher" class="form-control"></div>
            </div>
            <div class="mb-4"><label class="small fw-bold">æœ‰æ•ˆæœŸ</label><input type="date" name="expire_at" id="u_expire" class="form-control"></div>
            <button type="button" class="btn btn-primary w-100 rounded-pill" onclick="saveU()">ä¿å­˜</button>
        </form>
    </div>
</div>

<script>
const uModal = new bootstrap.Modal('#uModal');
function openU() { 
    document.getElementById('uForm').reset(); 
    document.getElementById('u_id').readOnly = false;
    document.getElementById('utitle').innerText = "æ–°å¢æˆæƒ";
    uModal.show(); 
}
function editU(id, name, area, teacher, expire) {
    document.getElementById('u_id').value = id;
    document.getElementById('u_id').readOnly = true;
    document.getElementById('u_name').value = name;
    document.getElementById('u_area').value = area;
    document.getElementById('u_teacher').value = teacher;
    document.getElementById('u_expire').value = expire;
    document.getElementById('utitle').innerText = "ä¿®æ”¹è®¤è¯ä¿¡æ¯";
    uModal.show();
}
async function saveU() {
    const fd = new FormData(document.getElementById('uForm'));
    fd.append('sid','{{sid}}'); fd.append('gid','{{gid}}');
    await fetch('/api/add_user', { method: 'POST', body: fd });
    location.reload();
}
</script>
{% endblock %}
