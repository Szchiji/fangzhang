{% extends "layout.html" %}
{% block content %}
<div class="card-custom">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="fw-bold m-0"><i class="bi bi-shield-check me-2 text-primary"></i>认证用户名单</h5>
        <button class="btn btn-primary rounded-pill px-4" onclick="showUserModal()">+ 手动添加</button>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr class="small text-secondary">
                    <th>用户/UID</th><th>地区</th><th>所属老师</th><th>到期时间</th><th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr id="row-{{u[0]}}">
                    <td>
                        <div class="fw-bold">{{u[2]}}</div>
                        <div class="small text-muted">{{u[0]}}</div>
                    </td>
                    <td><span class="badge bg-light text-dark fw-normal">{{u[3]}}</span></td>
                    <td>{{u[4] or '-'}}</td>
                    <td class="small">{{u[5] or '永久'}}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger border-0 rounded-circle" onclick="delUser('{{u[0]}}')">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
async function delUser(uid) {
    if(!confirm("确定要删除该用户权限吗？")) return;
    const fd = new FormData();
    fd.append('uid', uid); fd.append('gid', '{{gid}}');
    const res = await fetch('/api/user/del', {method:'POST', body:fd});
    if(res.ok) {
        document.getElementById(`row-${uid}`).style.opacity = '0';
        setTimeout(()=> document.getElementById(`row-${uid}`).remove(), 300);
    }
}
function showUserModal() { alert("7哥，手动添加功能可在此扩展弹窗！"); }
</script>
{% endblock %}
