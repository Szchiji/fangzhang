{% extends "layout.html" %}
{% block content %}
<div class="card p-4 border-0 shadow-sm">
    <div class="d-flex justify-content-between mb-4">
        <h5 class="fw-bold m-0"><i class="bi bi-shield-lock me-2 text-primary"></i>认证成员</h5>
        <button class="btn btn-dark rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#uModal">+ 新增认证</button>
    </div>

    <table class="table align-middle">
        <thead><tr class="small text-muted"><th>姓名</th><th>地区/老师</th><th>到期时间</th><th>操作</th></tr></thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td><b>{{u[2]}}</b><br><small class="text-muted">{{u[0]}}</small></td>
                <td>{{u[4] or '-'}} / {{u[5] or '-'}}</td>
                <td>{{u[7] or '永久'}}</td>
                <td><button class="btn btn-sm btn-outline-danger" onclick="delU('{{u[0]}}')">删除</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="uModal" tabindex="-1">
    <div class="modal-dialog"><form id="uForm" class="modal-content p-4 border-0 shadow">
        <h6 class="fw-bold mb-3">授权新用户</h6>
        <div class="mb-2"><label class="small fw-bold">Telegram ID</label><input type="text" name="user_id" class="form-control" required></div>
        <div class="mb-2"><label class="small fw-bold">显示名字</label><input type="text" name="name" class="form-control" required></div>
        <div class="row mb-2">
            <div class="col-6"><label class="small fw-bold">地区</label><input type="text" name="area" class="form-control"></div>
            <div class="col-6"><label class="small fw-bold">分配老师</label><input type="text" name="teacher" class="form-control"></div>
        </div>
        <div class="mb-4"><label class="small fw-bold">有效期</label><input type="date" name="expire_at" class="form-control"></div>
        <button type="button" onclick="saveU()" class="btn btn-primary w-100 py-2 rounded-pill">保存授权</button>
    </form></div>
</div>

<script>
async function saveU() {
    const fd = new FormData(document.getElementById('uForm'));
    fd.append('sid','{{sid}}'); fd.append('gid','{{gid}}');
    await fetch('/api/add_user', {method:'POST', body:fd});
    location.reload();
}
</script>
{% endblock %}
